<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Study Planner</title>
<style>

:root {
  --bg-dark:#141414; --bg-light:#f5f5f5;
  --card-dark:#1f1f1f; --card-light:#ffffff;
  --text-dark:#fff; --text-light:#000;
  --accent:#e50914;
}
body{
  margin:0;font-family:'Segoe UI',sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  transition:0.3s;
}
.container{ max-width:1200px;margin:auto;padding:20px; }
h1{text-align:center;color:var(--accent);font-size:2.5em;margin-bottom:20px;}


.dashboard{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px;margin-bottom:30px; }
.card{ padding:25px; border-radius:12px; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.6); transition:0.3s; }
.card:hover{ transform:translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.8); }
.card b{ display:block; margin-top:10px; font-size:1.5em; color: var(--accent); }


.form-group{ display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:10px;margin-bottom:20px; }
input,select,textarea,button{ padding:10px; border-radius:8px; border:none; outline:none; font-size:14px; }
input,select,textarea{ background:#333; color:white; }
textarea{ min-height:40px; resize:vertical; }
button{ background:var(--accent); color:white; cursor:pointer; transition:0.3s; }
button:hover{ background:#f6121d; transform:scale(1.05); }


.progress-container{ background:#333; border-radius:10px; height:12px; margin:10px 0; }
.progress-bar{ background:var(--accent); height:12px; border-radius:10px; width:0%; transition:0.3s; }


.task-list{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; }
.task{ padding:15px; border-radius:12px; display:flex; flex-direction:column; justify-content:space-between; box-shadow:0 5px 15px rgba(0,0,0,0.6); transition:0.2s; }
.task:hover{ transform:translateY(-3px); }
.task.done{ opacity:0.6; text-decoration:line-through; }
.task.overdue{ border-left:6px solid #ff4b4b; }
.task button{ margin:3px 2px; font-size:12px; padding:5px 8px; border-radius:5px; }
.edit-btn{ background:#ff9800; }
.delete-btn{ background:#b71c1c; }


.priority-high{ background: linear-gradient(135deg,#ff4b4b,#ff1e1e); }
.priority-medium{ background: linear-gradient(135deg,#ffb347,#ff9800); }
.priority-low{ background: linear-gradient(135deg,#4caf50,#81c784); }


#categoryFilter{ background:#333;color:white;padding:10px;border-radius:8px; }


.theme-toggle{ display:flex; justify-content:center; margin:10px 0; }
.theme-toggle button{ margin:0 5px; }


#countdown{ text-align:center; font-size:1.2em; margin:10px 0; color:var(--accent); font-weight:bold; }


.chart-container{ margin:20px 0; background:#222; padding:15px; border-radius:12px; }
.chart-bar{ height:20px; border-radius:10px; background:var(--accent); transition:0.3s; }


@media(max-width:600px){ .form-group, .dashboard, .task-list{ grid-template-columns:1fr; } }
</style>
</head>
<body>
<div class="container">
<h1>üé¨Smart Study Planner</h1>


<div class="dashboard" id="dashboardCards"></div>


<div id="countdown">Next Task: --</div>


<div class="theme-toggle">
<button onclick="setTheme('dark')">Dark Mode</button>
<button onclick="setTheme('light')">Light Mode</button>
<input type="color" id="customColor" onchange="setCustomAccent(this.value)" title="Custom Accent Color">
</div>


<select id="categoryFilter" onchange="renderTasks()"><option value="">All Categories</option></select>

<div class="form-group">
<input type="text" id="subjectInput" placeholder="Subject/Topic">
<select id="durationInput"><option value="30">30 mins</option><option value="60">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option></select>
<input type="datetime-local" id="timeInput">
<select id="priorityInput"><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option></select>
<input type="text" id="categoryInput" placeholder="Category/Tag">
<textarea id="noteInput" placeholder="Notes (optional)"></textarea>
<button onclick="addTask()">Add Task</button>
</div>


<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
<p class="summary" id="progressText">0 / 0 Completed</p>
<p class="summary" id="timeSummary">Total Planned: 0 mins | Completed: 0 mins</p>
<p class="streak" id="streakText">üî• Streak: 0 days</p>


<div class="task-list" id="taskList"></div>


<div style="text-align:center; margin-top:20px;">
<button onclick="exportTasks()">Export Tasks</button>
<input type="file" id="importFile" style="display:none;" onchange="importTasks(event)">
<button onclick="document.getElementById('importFile').click()">Import Tasks</button>
<button onclick="clearAllTasks()">Clear All Tasks</button>
</div>


<div class="chart-container">
<h3>Weekly Progress</h3>
<div class="chart-bar" id="weeklyChart" style="width:0%"></div>
</div>

</div>

<script>

let tasks = [];
let streak = 0;
let lastCompletedDate = "";
let customAccent = '#e50914';


function addTask(){
  const subject=document.getElementById("subjectInput").value.trim();
  const duration=document.getElementById("durationInput").value;
  const time=document.getElementById("timeInput").value;
  const priority=document.getElementById("priorityInput").value;
  const note=document.getElementById("noteInput").value.trim();
  const category=document.getElementById("categoryInput").value.trim()||"General";
  if(!subject) return alert("Enter subject!");
  tasks.push({subject,duration,time,priority,note,category,done:false});
  updateCategoryFilter();
  renderTasks();
  document.getElementById("subjectInput").value="";
  document.getElementById("timeInput").value="";
  document.getElementById("noteInput").value="";
  document.getElementById("categoryInput").value="";
}


function toggleDone(i){
  tasks[i].done=!tasks[i].done;
  if(tasks[i].done){
    const today=new Date().toDateString();
    if(today!==lastCompletedDate){ streak++; lastCompletedDate=today; }
  }
  renderTasks();
}


function editTask(i){
  const t=tasks[i];
  const newSubject=prompt("Edit subject:",t.subject); if(newSubject)t.subject=newSubject;
  const newDuration=prompt("Edit duration:",t.duration); if(newDuration&&!isNaN(newDuration))t.duration=newDuration;
  const newTime=prompt("Edit time:",t.time); if(newTime)t.time=newTime;
  const newPriority=prompt("Edit priority:",t.priority); if(newPriority)t.priority=newPriority;
  const newCategory=prompt("Edit category:",t.category); if(newCategory)t.category=newCategory;
  const newNote=prompt("Edit note:",t.note); if(newNote!==null)t.note=newNote;
  updateCategoryFilter();
  renderTasks();
}


function removeTask(i){ tasks.splice(i,1); updateCategoryFilter(); renderTasks(); }


function clearAllTasks(){ if(confirm("Clear all?")){ tasks=[]; streak=0; lastCompletedDate=""; updateCategoryFilter(); renderTasks(); } }


function renderTasks(){
  const list=document.getElementById("taskList");
  list.innerHTML="";
  const filter=document.getElementById("categoryFilter").value;
  const now=new Date();
  let nextTask=null;
  tasks.forEach((t,i)=>{
    if(filter && t.category!==filter) return;
    const div=document.createElement("div");
    let overdue=t.time && new Date(t.time)<now && !t.done;
    div.className="task priority-"+t.priority+(t.done?" done":"")+(overdue?" overdue":"");
    div.style.background=div.classList.contains('priority-high')?`linear-gradient(135deg,#ff4b4b,${customAccent})`:
                       div.classList.contains('priority-medium')?`linear-gradient(135deg,#ffb347,${customAccent})`:
                       `linear-gradient(135deg,#4caf50,${customAccent})`;
    div.innerHTML=`<span><b>${t.subject}</b> - ${t.duration} mins<br>‚è∞ ${t.time?new Date(t.time).toLocaleString():"No time"}<br>üî• ${t.priority} | üè∑Ô∏è ${t.category}</span>
    ${t.note?`<div class="note">üìù ${t.note}</div>`:""}
    <div>
      <button class="edit-btn" onclick="editTask(${i})">‚úèÔ∏è Edit</button>
      <button onclick="toggleDone(${i})">‚úÖ</button>
      <button class="delete-btn" onclick="removeTask(${i})">‚ùå</button>
    </div>`;
    list.appendChild(div);
    if(!nextTask && !t.done && t.time) nextTask=t;
  });
  updateProgress();
  renderDashboard();
  updateCountdown(nextTask);
  sendNotifications(nextTask);
}


function updateProgress(){
  const total=tasks.length;
  const done=tasks.filter(t=>t.done).length;
  const percent=total===0?0:(done/total)*100;
  document.getElementById("progressBar").style.width=percent+"%";
  const totalMins=tasks.reduce((sum,t)=>sum+Number(t.duration),0);
  const completedMins=tasks.filter(t=>t.done).reduce((sum,t)=>sum+Number(t.duration),0);
  document.getElementById("progressText").textContent=`${done} / ${total} Completed`;
  document.getElementById("timeSummary").textContent=`Total Planned: ${totalMins} mins | Completed: ${completedMins} mins`;
  document.getElementById("streakText").textContent=`üî• Streak: ${streak} days`;
  document.getElementById("weeklyChart").style.width=percent+"%";
}


function renderDashboard(){
  const dash=document.getElementById("dashboardCards");
  const total=tasks.length;
  const done=tasks.filter(t=>t.done).length;
  const totalMins=tasks.reduce((sum,t)=>sum+Number(t.duration),0);
  const completedMins=tasks.filter(t=>t.done).reduce((sum,t)=>sum+Number(t.duration),0);
  const highPriority=tasks.filter(t=>t.priority==="high").length;
  const upcoming=tasks.filter(t=>!t.done && t.time).sort((a,b)=>new Date(a.time)-new Date(b.time))[0];
  dash.innerHTML=`
    <div class="card">Total Tasks<b>${total}</b></div>
    <div class="card">Completed<b>${done}</b></div>
    <div class="card">Total Time<b>${totalMins} mins</b></div>
    <div class="card">Completed Time<b>${completedMins} mins</b></div>
    <div class="card">High Priority<b>${highPriority}</b></div>
    <div class="card">Streak<b>${streak} days</b></div>
    <div class="card">Next Task<b>${upcoming?upcoming.subject+" @ "+new Date(upcoming.time).toLocaleString():"No upcoming"}</b></div>`;
}


function setTheme(mode){
  if(mode==="light"){
    document.body.style.background="var(--bg-light)";
    document.body.style.color="var(--text-light)";
  } else {
    document.body.style.background="var(--bg-dark)";
    document.body.style.color="var(--text-dark)";
  }
}
function setCustomAccent(color){ customAccent=color; renderTasks(); }


function updateCategoryFilter(){
  const filter=document.getElementById("categoryFilter");
  const categories=[...new Set(tasks.map(t=>t.category))];
  filter.innerHTML='<option value="">All Categories</option>'+categories.map(c=>`<option value="${c}">${c}</option>`).join("");
}


function exportTasks(){
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tasks));
  const dlAnchor = document.createElement('a');
  dlAnchor.setAttribute("href", dataStr);
  dlAnchor.setAttribute("download", "tasks.json");
  dlAnchor.click();
}
function importTasks(event){
  const file=event.target.files[0];
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const imported=JSON.parse(e.target.result);
      if(Array.isArray(imported)) tasks=imported;
      updateCategoryFilter();
      renderTasks();
    }catch(err){ alert("Invalid file"); }
  };
  reader.readAsText(file);
  event.target.value="";
}


function updateCountdown(nextTask){
  const countdown=document.getElementById("countdown");
  if(!nextTask || !nextTask.time){ countdown.textContent="Next Task: --"; return; }
  const now=new Date();
  const target=new Date(nextTask.time);
  let diff=Math.max(0,target-now);
  let hours=Math.floor(diff/1000/60/60);
  let mins=Math.floor(diff/1000/60)%60;
  let secs=Math.floor(diff/1000)%60;
  countdown.textContent=`Next Task: ${nextTask.subject} in ${hours}h ${mins}m ${secs}s`;
}
function sendNotifications(nextTask){
  if(!nextTask || !nextTask.time) return;
  const target=new Date(nextTask.time);
  const now=new Date();
  if(target-now<=5000 && !nextTask.notified){ 
    if(Notification.permission==="granted"){ new Notification("Upcoming Task", {body: nextTask.subject}); }
    nextTask.notified=true;
  }
}
setInterval(()=>renderTasks(),1000);
if(Notification.permission!=="granted"){ Notification.requestPermission(); }


updateCategoryFilter();
renderTasks();
</script>
</body>
</html>
